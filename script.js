const data = [


{
    "uploader": "Admin",
    "filename": "img21.png",
    "id": 21,
    "names": [
        "Pandaitis",
        "Slayer"
    ],
    "year": 2025,
    "month": 7,
    "nsfw": false,
    "date_uploaded_day": 20,
    "date_uploaded_month": 7,
    "date_uploaded_year": 2025,
    "description": ""
},
         {
    "uploader": "Admin",
    "filename": "img20.png",
    "id": 20,
    "names": [
        "Annara",
        "Terraha",
        "Lucky",
        "Textfile"
    ],
    "year": 2025,
    "month": 7,
    "nsfw": false,
    "date_uploaded_day": 20,
    "date_uploaded_month": 7,
    "date_uploaded_year": 2025,
    "description": ""
},
{
        "uploader": "Admin",
        "filename": "img19.png",
        "id": 19,
        "names": ["Annara", "Cheesypuffmi"],
        "year": 2025,
        "month": 7,
        "nsfw": false,
        "date_uploaded_day": 19,
        "date_uploaded_month": 7,
        "date_uploaded_year": 2025,
        "description": ""
    },
     {
        "uploader": "Admin",
        "filename": "img18.png",
        "id": 18,
        "names": ["Gayoctopus"],
        "year": 2025,
        "month": 7,
        "nsfw": false,
        "date_uploaded_day": 19,
        "date_uploaded_month": 7,
        "date_uploaded_year": 2025,
        "description": ""
    },
{
        "uploader": "Admin",
        "filename": "img17.png",
        "id": 17,
        "names": ["Benuel"],
        "year": 2025,
        "month": 7,
        "nsfw": false,
        "date_uploaded_day": 19,
        "date_uploaded_month": 7,
        "date_uploaded_year": 2025,
        "description": ""
    },
{
        "uploader": "Admin",
        "filename": "img16.png",
        "id": 16,
        "names": ["Hariiiiissss", "Cheesypuffmi"],
        "year": 2025,
        "month": 7,
        "nsfw": false,
        "date_uploaded_day": 19,
        "date_uploaded_month": 7,
        "date_uploaded_year": 2025,
        "description": ""
    },
{
        "uploader": "Admin",
        "filename": "img15.png",
        "id": 15,
        "names": ["Hariiiiissss", "Annara"],
        "year": 2025,
        "month": 7,
        "nsfw": false,
        "date_uploaded_day": 19,
        "date_uploaded_month": 7,
        "date_uploaded_year": 2025,
        "description": ""
    },
{
        "uploader": "Admin",
        "filename": "img14.png",
        "id": 14,
        "names": ["Lovelywings"],
        "year": 2025,
        "month": 7,
        "nsfw": false,
        "date_uploaded_day": 19,
        "date_uploaded_month": 7,
        "date_uploaded_year": 2025,
        "description": ""
    },
     {
        "uploader": "Admin",
        "filename": "img13.png",
        "id": 13,
        "names": ["Annara", "Textfile"],
        "year": 2025,
        "month": 7,
        "nsfw": false,
        "date_uploaded_day": 19,
        "date_uploaded_month": 7,
        "date_uploaded_year": 2025,
        "description": ""
    },
{
        "uploader": "Admin",
        "filename": "img12.png",
        "id": 12,
        "names": ["Cheesypuffmi"],
        "year": 2025,
        "month": 7,
        "nsfw": false,
        "date_uploaded_day": 19,
        "date_uploaded_month": 7,
        "date_uploaded_year": 2025,
        "description": ""
    },
{
        "uploader": "Admin",
        "filename": "img11.png",
        "id": 11,
        "names": ["Lovelywings", "Textfile", "Annara"],
        "year": 2025,
        "month": 7,
        "nsfw": false,
        "date_uploaded_day": 19,
        "date_uploaded_month": 7,
        "date_uploaded_year": 2025,
        "description": ""
    },
{
        "uploader": "Admin",
        "filename": "img10.png",
        "id": 10,
        "names": ["Annara", "Textfile"],
        "year": 2025,
        "month": 7,
        "nsfw": false,
        "date_uploaded_day": 19,
        "date_uploaded_month": 7,
        "date_uploaded_year": 2025,
        "description": ""
    },
    {
        "uploader": "Admin",
        "filename": "img9.png",
        "id": 9,
        "names": ["Pocky", "Textfile"],
        "year": 2025,
        "month": 7,
        "nsfw": false,
        "date_uploaded_day": 19,
        "date_uploaded_month": 7,
        "date_uploaded_year": 2025,
        "description": ""
    }, 
    {
        "uploader": "Admin",
        "filename": "img1.png",
        "id": 1,
        "names": ["Escape"],
        "year": 2025,
        "month": null,
        "nsfw": false,
        "date_uploaded_day": 16,
        "date_uploaded_month": 7,
        "date_uploaded_year": 2025,
        "description": "Escape makes an inappropriate message"
    },
    {
        "uploader": "Admin",
        "filename": "img2.png",
        "id": 2,
        "names": ["Pandaitis", "Slayer", "Pocky"],
        "year": 2025,
        "month": 7,
        "nsfw": true,
        "date_uploaded_day": 16,
        "date_uploaded_month": 7,
        "date_uploaded_year": 2025,
        "description": "Pocky frustrated over pandaitis and slayer"
    },
    {
        "uploader": "Admin",
        "filename": "img3.png",
        "id": 3,
        "names": ["Snail"],
        "year": 2025,
        "month": 7,
        "nsfw": false,
        "date_uploaded_day": 16,
        "date_uploaded_month": 7,
        "date_uploaded_year": 2025,
        "description": "Snail talks about big butts in Instagram"
    },
    {
        "uploader": "Admin",
        "filename": "img4.png",
        "id": 4,
        "names": ["Pandaitis"],
        "year": 2025,
        "month": 7,
        "nsfw": false,
        "date_uploaded_day": 16,
        "date_uploaded_month": 7,
        "date_uploaded_year": 2025,
        "description": "Pandaitis wishing Slayer a good time"
    },
    {
        "uploader": "Admin",
        "filename": "img5.png",
        "id": 5,
        "names": ["Textfile"],
        "year": 2025,
        "month": 7,
        "nsfw": false,
        "date_uploaded_day": 16,
        "date_uploaded_month": 7,
        "date_uploaded_year": 2025,
        "description": "Textfile going insane"
    },
    {
        "uploader": "Admin",
        "filename": "img6.png",
        "id": 6,
        "names": ["Robin", "Birdland"],
        "year": 2025,
        "month": 7,
        "nsfw": true,
        "date_uploaded_day": 16,
        "date_uploaded_month": 7,
        "date_uploaded_year": 2025,
        "description": "Robin shares his childhood fantasies"
    },
    {
        "uploader": "Admin",
        "filename": "img7.png",
        "id": 7,
        "names": ["Spageti", "Aqozie"],
        "year": 2025,
        "month": 7,
        "nsfw": false,
        "date_uploaded_day": 16,
        "date_uploaded_month": 7,
        "date_uploaded_year": 2025,
        "description": "Spageti and Aqozie hating on pride parades"
    },
    {
        "uploader": "Admin",
        "filename": "img8.png",
        "id": 8,
        "names": ["Apyr"],
        "year": 2025,
        "month": 7,
        "nsfw": false,
        "date_uploaded_day": 16,
        "date_uploaded_month": 7,
        "date_uploaded_year": 2025,
        "description": "Apyr shares trauma from TFM discord server"
    }
    
];

// Initial sort by newest (highest ID = newest)
data.sort((a, b) => b.id - a.id);


document.addEventListener('DOMContentLoaded', () => {
    const createBtnUniqueXyz = document.getElementById('create');
    const uploadyDivUniqueXyz = document.getElementById('uploady');



    createBtnUniqueXyz.addEventListener('click', () => {
        uploadyDivUniqueXyz.style.display = 'block';
    });

    let isDragActiveUniqueXyz = false;
    let dragOffsetXUniqueXyz = 0;
    let dragOffsetYUniqueXyz = 0;

    uploadyDivUniqueXyz.addEventListener('mousedown', (e) => {
        isDragActiveUniqueXyz = true;

        // Use offsetLeft instead of getBoundingClientRect to avoid border/padding shift
        dragOffsetXUniqueXyz = e.clientX - uploadyDivUniqueXyz.offsetLeft;
        dragOffsetYUniqueXyz = e.clientY - uploadyDivUniqueXyz.offsetTop;

        document.body.style.userSelect = 'none';
    });

    window.addEventListener('mouseup', () => {
        isDragActiveUniqueXyz = false;
        document.body.style.userSelect = '';
    });

    window.addEventListener('mousemove', (e) => {
        if (!isDragActiveUniqueXyz) return;

        let posX = e.clientX - dragOffsetXUniqueXyz;
        let posY = e.clientY - dragOffsetYUniqueXyz;

        const maxPosX = window.innerWidth - uploadyDivUniqueXyz.offsetWidth;
        const maxPosY = window.innerHeight - uploadyDivUniqueXyz.offsetHeight;

        posX = Math.min(Math.max(0, posX), maxPosX);
        posY = Math.min(Math.max(0, posY), maxPosY);

        uploadyDivUniqueXyz.style.left = posX + 'px';
        uploadyDivUniqueXyz.style.top = posY + 'px';


        const resetlol = document.getElementById('resetlol');
        const uploadForm = document.getElementById('uploadform');




        resetlol.addEventListener('click', () => {
            uploadForm.reset();

        });
        const uploady = document.getElementById('uploady');

        const closelol = document.getElementById('closelol');

        closelol.addEventListener('click', () => {
            uploady.style.display = 'none';
        });


    });
});




const container = document.getElementById('gallery-container');
container.style.display = 'grid';
container.style.gridTemplateColumns = '1fr';
container.style.gap = '5px';
container.style.paddingInline = '8px';

// --- Pagination Variables ---
const itemsPerPage = 25;
let currentPage = 1;
const paginationContainer = document.createElement('div');
paginationContainer.id = 'pagination-container';
Object.assign(paginationContainer.style, {
    textAlign: 'center',
    marginTop: '15px', // Reduced margin-top
    marginBottom: '15px', // Reduced margin-bottom
    fontFamily: 'Arial, sans-serif',
    fontSize: '17px',
    color: '#f6d690',
    display: 'flex', // Use flexbox for centering
    justifyContent: 'center', // Center content horizontally
    alignItems: 'center', // Center content vertically
    height: '40px' // Set a fixed height for the pagination bar
});
// Append to the gallery container itself, so it scrolls with the content
container.insertAdjacentElement('afterend', paginationContainer);


function renderGallery(items) {
    // Temporarily clear the pagination container before clearing the gallery
    // This prevents the pagination from briefly disappearing if it's already rendered
    paginationContainer.innerHTML = '';
    container.innerHTML = '';


    // Calculate items for the current page
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    const itemsToDisplay = items.slice(startIndex, endIndex);

    itemsToDisplay.forEach(item => {
        const wrapper = document.createElement('div');
        wrapper.style.border = '1px solid black';
        wrapper.style.borderRadius = '4px';
        wrapper.style.padding = '10px';
        wrapper.style.background = '#28444c';
        wrapper.style.color = 'white';
        wrapper.style.boxSizing = 'border-box';

        wrapper.addEventListener('mouseenter', () => {
            wrapper.style.background = '#305c64';
            wrapper.style.cursor = 'pointer';
        });
        wrapper.addEventListener('mouseleave', () => {
            wrapper.style.background = '#28444c';
        });

        const text = document.createElement('p');
        text.textContent = item.description;
        text.style.fontSize = '20px';
        text.style.marginTop = '0px';
        text.style.marginBottom = '3px';
        text.style.marginInline = '20px';
        text.style.fontFamily = 'Arial, sans-serif';

        const infoLine = document.createElement('p');
        infoLine.style.fontSize = '20px';
        infoLine.style.fontFamily = 'Arial, sans-serif';
        infoLine.style.marginTop = '0px';
        infoLine.style.marginBottom = '5px';
        infoLine.style.marginInline = '20px';

        const idSpan = document.createElement('span');
        idSpan.textContent = `#${item.id}`;
        idSpan.style.color = '#ffd991';
        infoLine.appendChild(idSpan);

        const commaAfterId = document.createElement('span');
        commaAfterId.textContent = ', ';
        commaAfterId.style.color = '#6c77c1';
        infoLine.appendChild(commaAfterId);

        const numSpan = document.createElement('span');
        numSpan.textContent = `${item.names.length}`;
        numSpan.style.color = '#ffd991';
        infoLine.appendChild(numSpan);

        const commaAfterNum = document.createElement('span');
        commaAfterNum.textContent = ', ';
        commaAfterNum.style.color = '#6c77c1';
        infoLine.appendChild(commaAfterNum);

        item.names.forEach((name, index) => {
            const nameSpan = document.createElement('span');
            nameSpan.textContent = name;
            nameSpan.style.color = '#6c77c1';
            infoLine.appendChild(nameSpan);

            if (index < item.names.length - 1) {
                const comma = document.createElement('span');
                comma.textContent = ', ';
                comma.style.color = '#6c77c1';
                infoLine.appendChild(comma);
            }
        });

        const img = document.createElement('img');
        img.src = `archive/${item.filename}`;
        img.alt = item.description;
        img.style.width = '700px';
        img.style.marginInline = '20px';
        img.style.height = 'auto';
        img.style.borderRadius = '0';
        img.style.display = 'block';
        img.style.filter = 'saturate(110%) contrast(138%) drop-shadow(0px 0px 5px #000000)';
        img.style.webkitFilter = 'saturate(110%) contrast(120%) drop-shadow(0px 0px 3px #000000)';
        img.style.mozFilter = 'saturate(110%) contrast(138%) drop-shadow(0px 0px 5px #000000)';

        wrapper.appendChild(text);
        wrapper.appendChild(infoLine);
        wrapper.appendChild(img);

        // Create meta info container
        const metaRow = document.createElement('div');
        metaRow.style.display = 'flex';
        metaRow.style.justifyContent = 'space-between';
        metaRow.style.marginTop = '10px';
        metaRow.style.marginInline = '20px';
        metaRow.style.width = '700px'; // Match image width

        // Shared style
        const font = 'Arial, sans-serif';
        const fontSize = '19px';
        const labelColor = '#ffd991';
        const valueColor = '#7077c1';

        // Helper to format date
        const formatDate = (day, month, year) =>
            `${String(day).padStart(2, '0')}/${String(month || 0).padStart(2, '0')}/${year}`;

        // Taken
        const takenDiv = document.createElement('div');
        takenDiv.style.flex = '1';
        takenDiv.style.fontFamily = font;
        takenDiv.style.fontSize = fontSize;
        takenDiv.innerHTML = `<span style="color:${labelColor}">Taken:</span> 
<span style="color:${valueColor}">${formatDate(item.date_uploaded_day, item.month, item.year)}</span>`;

        // Uploaded
        const uploadedDiv = document.createElement('div');
        uploadedDiv.style.flex = '1';
        uploadedDiv.style.fontFamily = font;
        uploadedDiv.style.fontSize = fontSize;
        uploadedDiv.innerHTML = `<span style="color:${labelColor}">Uploaded:</span> 
<span style="color:${valueColor}">${formatDate(item.date_uploaded_day, item.date_uploaded_month, item.date_uploaded_year)}</span>`;

        // Uploader
        const uploaderDiv = document.createElement('div');
        uploaderDiv.style.flex = '1';
        uploaderDiv.style.fontFamily = font;
        uploaderDiv.style.fontSize = fontSize;
        uploaderDiv.innerHTML = `<span style="color:${labelColor}">Uploader:</span> 
<span style="color:${valueColor}">${item.uploader}</span>`;

        // Add all three to row
        metaRow.appendChild(takenDiv);
        metaRow.appendChild(uploadedDiv);
        metaRow.appendChild(uploaderDiv);

        // Append to wrapper
        wrapper.appendChild(metaRow);
        container.appendChild(wrapper);
    });

    renderPagination(items.length);
}

function renderPagination(totalItems) {
    paginationContainer.innerHTML = ''; // Clear previous pagination
    const totalPages = Math.ceil(totalItems / itemsPerPage);

    if (totalPages <= 1 && totalItems > 0) { // Still show current page if only one page exists
        const pageInfo = document.createElement('span');
        pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
        paginationContainer.appendChild(pageInfo);
        return;
    } else if (totalPages === 0) { // No items, no pagination
        return;
    }

    const prevButton = document.createElement('button');
    prevButton.textContent = '<<'; // Changed to just "<<"
    Object.assign(prevButton.style, {
        margin: '0 8px', // Adjusted margin
        padding: '3px 8px', // Adjusted padding for less height
        cursor: 'pointer',
        fontWeight: 'bold',
        backgroundColor: '#18242c',
        color: '#f6d690',
        border: '1px solid #f6d690',
        borderRadius: '4px',
        fontFamily: 'Arial, sans-serif',
        fontSize: '16px' // Slightly smaller font size
    });
    prevButton.disabled = currentPage === 1;
    prevButton.addEventListener('click', () => {
        if (currentPage > 1) {
            currentPage--;
            renderGallery(currentDisplayed);
            window.scrollTo(0, 0); // Scroll to top when changing page
        }
    });
    paginationContainer.appendChild(prevButton);

    const pageInfoSpan = document.createElement('span');
    pageInfoSpan.textContent = `Page `; // Added space
    pageInfoSpan.style.margin = '0 3px'; // Adjusted margin
    paginationContainer.appendChild(pageInfoSpan);

    const pageInput = document.createElement('input');
    pageInput.type = 'number';
    pageInput.min = 1;
    pageInput.max = totalPages;
    pageInput.value = currentPage;
    Object.assign(pageInput.style, {
        width: '40px',
        textAlign: 'center',
        backgroundColor: '#28444c',
        color: '#f6d690',
        border: '1px solid #f6d690',
        borderRadius: '4px',
        fontFamily: 'Arial, sans-serif',
        fontSize: '16px', // Slightly smaller font size
        padding: '2px' // Adjusted padding for less height
    });
    pageInput.addEventListener('change', (e) => {
        let newPage = parseInt(e.target.value);
        if (isNaN(newPage) || newPage < 1) {
            newPage = 1;
        } else if (newPage > totalPages) {
            newPage = totalPages;
        }
        currentPage = newPage;
        renderGallery(currentDisplayed);
        window.scrollTo(0, 0); // Scroll to top when changing page
    });
    paginationContainer.appendChild(pageInput);

    const totalPagesSpan = document.createElement('span');
    totalPagesSpan.textContent = ` of ${totalPages}`; // Added space before "of"
    totalPagesSpan.style.margin = '0 3px'; // Adjusted margin
    paginationContainer.appendChild(totalPagesSpan);


    const nextButton = document.createElement('button');
    nextButton.textContent = '>>'; // Changed to just ">>"
    Object.assign(nextButton.style, {
        margin: '0 8px', // Adjusted margin
        padding: '3px 8px', // Adjusted padding for less height
        cursor: 'pointer',
        fontWeight: 'bold',
        backgroundColor: '#18242c',
        color: '#f6d690',
        border: '1px solid #f6d690',
        borderRadius: '4px',
        fontFamily: 'Arial, sans-serif',
        fontSize: '16px' // Slightly smaller font size
    });
    nextButton.disabled = currentPage === totalPages;
    nextButton.addEventListener('click', () => {
        if (currentPage < totalPages) {
            currentPage++;
            renderGallery(currentDisplayed);
            window.scrollTo(0, 0); // Scroll to top when changing page
        }
    });
    paginationContainer.appendChild(nextButton);
}


// Track currently displayed items after filtering
let currentDisplayed = [...data];

// Initial render with pagination
renderGallery(currentDisplayed);

// --- SORT BUTTON & MENU ---

const sortButton = document.getElementById('sort');
let sortMenu = null;

sortButton.addEventListener('click', () => {
    if (sortMenu) {
        // Toggle visibility
        if (sortMenu.style.display === 'block') {
            sortMenu.style.display = 'none';
        } else {
            sortMenu.style.display = 'block';
        }
        return;
    }

    sortMenu = document.createElement('div');
    sortMenu.style.position = 'absolute';
    sortMenu.style.background = '#18242c';
    sortMenu.style.border = '1px solid black';
    sortMenu.style.borderRadius = '3px';
    sortMenu.style.padding = '3px';
    sortMenu.style.zIndex = 10000;
    sortMenu.style.top = (sortButton.getBoundingClientRect().bottom + window.scrollY) + 'px';
    sortMenu.style.left = (sortButton.getBoundingClientRect().left + window.scrollX) + 'px';
    sortMenu.style.color = 'white';
    sortMenu.style.fontFamily = 'Arial, sans-serif';
    sortMenu.style.fontSize = '13px';
    sortMenu.style.minWidth = '150px';

    const options = [
        { id: 'uploaded-desc', label: 'Newest Uploaded First' },
        { id: 'uploaded-asc', label: 'Oldest Uploaded First' },
        { id: 'names-asc', label: 'Fewest Names First' },
        { id: 'names-desc', label: 'Most Names First' },
        { id: 'liked-desc', label: 'Most Liked (TODO)' },
        { id: 'liked-asc', label: 'Least Liked (TODO)' },
    ];

    options.forEach(opt => {
        const optDiv = document.createElement('div');
        optDiv.textContent = opt.label;
        optDiv.style.padding = '6px 10px';
        optDiv.style.cursor = 'pointer';

        optDiv.addEventListener('mouseenter', () => {
            optDiv.style.background = '#28444c';
        });
        optDiv.addEventListener('mouseleave', () => {
            optDiv.style.background = '#18242c';
        });

        optDiv.addEventListener('click', () => {
            sortMenu.style.display = 'none';

            let sortedData = [...currentDisplayed];

            switch (opt.id) {
                case 'uploaded-desc':
                    // Sort by id descending (newest first)
                    sortedData.sort((a, b) => b.id - a.id);
                    break;
                case 'uploaded-asc':
                    // Sort by id ascending (oldest first)
                    sortedData.sort((a, b) => a.id - b.id);
                    break;
                case 'names-asc':
                    sortedData.sort((a, b) => a.names.length - b.names.length);
                    break;
                case 'names-desc':
                    sortedData.sort((a, b) => b.names.length - a.names.length);
                    break;
                case 'liked-desc':
                case 'liked-asc':
                    alert("Sorting by liked/saved is not implemented yet.");
                    return;
            }
            currentPage = 1; // Reset to first page after sorting
            renderGallery(sortedData);
            currentDisplayed = sortedData;
        });

        sortMenu.appendChild(optDiv);
    });

    document.body.appendChild(sortMenu);
});

// --- SEARCH FORM ---

const search = document.getElementById('search');
const formy = document.getElementById('formy');

search.addEventListener('click', () => {
    formy.style.display = 'block';
});

// Drag functionality
let isDragging = false;
let offsetX = 0;
let offsetY = 0;

formy.addEventListener('mousedown', (e) => {
    isDragging = true;
    offsetX = e.clientX - formy.offsetLeft;
    offsetY = e.clientY - formy.offsetTop;
    formy.style.position = 'absolute';
});

document.addEventListener('mouseup', () => {
    isDragging = false;
});

document.addEventListener('mousemove', (e) => {
    if (isDragging) {
        formy.style.left = (e.clientX - offsetX) + 'px';
        formy.style.top = (e.clientY - offsetY) + 'px';
    }
});

const closey = document.getElementById('closey');

closey.addEventListener('click', () => {
    formy.style.display = 'none';
});

const form = document.querySelector('#formy form');
const resety = document.getElementById('resety');

resety.addEventListener('click', () => {
    form.reset();
    currentPage = 1; // Reset to first page after resetting filter
    currentDisplayed = [...data];
    renderGallery(currentDisplayed);
});

const searchForm = document.querySelector('#formy form');
const randomBtn = searchForm.querySelector('button[type="button"]');

function filterData(filters) {
    return data.filter(item => {
        if (filters.id !== '' && Number(filters.id) !== item.id) return false;

        if (filters.nicknames.trim() !== '') {
            const searchNames = filters.nicknames.toLowerCase().split(',').map(s => s.trim()).filter(s => s.length > 0);
            const itemNamesLower = item.names.map(n => n.toLowerCase());

            const found = searchNames.some(sn => itemNamesLower.includes(sn));
            if (!found) return false;
        }

        if (filters.year !== '') {
            if (item.year !== Number(filters.year)) return false;
        }

        if (filters.month !== '') {
            if (item.month !== Number(filters.month)) return false;
        }

        if (filters.yearUploaded !== '') {
            if (item.date_uploaded_year !== Number(filters.yearUploaded)) return false;
        }

        if (filters.monthUploaded !== '') {
            if (item.date_uploaded_month !== Number(filters.monthUploaded)) return false;
        }

        return true;
    });
}

function getFormValues() {
    return {
        id: document.getElementById('id').value.trim(),
        nicknames: document.getElementById('nicknames').value.trim(),
        year: document.getElementById('year').value,
        month: document.getElementById('month').value,
        yearUploaded: document.getElementById('yearUploaded').value,
        monthUploaded: document.getElementById('monthUploaded').value
    };
}

searchForm.addEventListener('submit', e => {
    e.preventDefault();
    const filters = getFormValues();
    const filtered = filterData(filters);
    currentPage = 1; // Reset to first page after applying filter
    renderGallery(filtered);
    currentDisplayed = filtered;
});

randomBtn.addEventListener('click', () => {
    const filters = getFormValues();
    const filtered = filterData(filters);
    if (filtered.length === 0) {
        alert('No images found for the selected criteria.');
        return;
    }
    const randIndex = Math.floor(Math.random() * filtered.length);
    currentPage = 1; // If showing a single random, reset page
    renderGallery([filtered[randIndex]]);
    currentDisplayed = [filtered[randIndex]];
});

document.getElementById('uploadform').addEventListener('submit', function (e) {
    e.preventDefault();

    const data = `Uploader: ${document.getElementById('uploader').value}
Description: ${document.getElementById('descriptions').value}
Nicknames: ${document.getElementById('names').value}
Notes: ${document.getElementById('notes').value}
Year: ${document.getElementById('yearupload').value}
Month: ${document.getElementById('monthupload').value}
Image URL: ${document.getElementById('imgurl').value}`;

    const entryId = 'entry.549147691';
    const formBase = 'https://docs.google.com/forms/d/e/1FAIpQLSdINPf5DPLZh1Ah20k8rdi6LQMEIj8RaAIdmsBLS6ZjMnGb9g/viewform?usp=pp_url';

    const url = `${formBase}&${entryId}=${encodeURIComponent(data)}`;
    window.location.href = url;
});

document.addEventListener("DOMContentLoaded", () => {
    const contactBtn = document.getElementById("contact");

    contactBtn.style.cursor = "pointer";
    contactBtn.style.position = "relative";

    contactBtn.addEventListener("click", () => {
        const existingPopup = document.getElementById("contact-popup");

        if (existingPopup) {
            existingPopup.remove();
            return;
        }

        const popup = document.createElement("div");
        popup.id = "contact-popup";
        popup.innerHTML = `
            <div style="color: white; font-weight: bold; margin-bottom: 6px;">Contact the archive:</div>
            <div><span style="color: #fad991;">Transformice:</span> <span style="color: #7077c1;">Pocky#8394</span></div>
            <div><span style="color: #fad991;">Email:</span> <span style="color: #7077c1;">Thecafearchives@gmail.com</span></div>
        `;

        Object.assign(popup.style, {
            position: "absolute",
            top: contactBtn.offsetHeight + 4 + "px",
            left: "0px",
            backgroundColor: "#20242c",
            border: "1px solid black",
            borderRadius: "4px",
            fontFamily: "Arial",
            fontSize: "18px",
            padding: "15px",
            zIndex: 9999,
            boxShadow: "0 2px 5px rgba(0,0,0,0.2)"
        });

        contactBtn.appendChild(popup);

        const removePopup = (e) => {
            if (!popup.contains(e.target) && e.target !== contactBtn) {
                popup.remove();
                document.removeEventListener("click", removePopup);
            }
        };

        setTimeout(() => {
            document.addEventListener("click", removePopup);
        }, 0);
    });
});
